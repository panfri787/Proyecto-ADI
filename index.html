<!DOCTYPE html>


<html>

	<head>
		<title>Muevete.org</title>
		<meta charset="utf-8">
		<link rel="stylesheet" type="text/css" href="/muevete/stylesheet/bootstrap.css" media="screen" />
	</head>

	<body>
		<div class="navbar navbar-default navbar-fixed-top">
			<div class="container">
				<div class="navbar-header">
					<a href="/muevete/index" class="navbar-brand">Muevete.org</a>
				</div>
				<ul id="listaCabecera" class="nav navbar-nav navbar-right">
					<li><a href="javascript:showLoginLightbox()">Login</a></li>
					<li><a href="javascript:showLightbox();">Registrarse</a></li>
	            </ul>
			</div>
		</div>

		<div class="container">
			<div class="page-header" id="banner">
		        <div class="row">
					<div class="col-lg-12">
						<h1>Peticiones destacadas</h1>
					</div>
	        	</div>
      		</div>

	      	<div class="row">
	      		{{#destacadas}}
	      		<div class="col-lg-12">
					<div class="jumbotron">
						<div class="col-lg-3">
							<img alt="#" width="200" src="img/peticiones/{{id}}.jpg">
						</div>
						<div class="col-lg-9">
							<h2><strong>{{titulo}}</strong></h2>
						</div>	
						<ul class="nav nav-pills">
							<li class="col-lg-10">
								<p>Firmas conseguidas
			            			<span class="badge">{{firmasConseguidas}}</span>
			            		</p>
			            		<div class="progress progress-striped activate">
									<div class="progress-bar" style="width: {{firmasConseguidas}}%"></div>
								</div>
							</li>
							<li>
								<a class="btn btn-primary btn-lg" href="/muevete/peticion?id={{id}}">Ver peticion</a>
							</li>	
						</ul>      
			        </div>
			    </div>
			{{/destacadas}}
	      	</div>
	    </div>
	    <div class="panel-footer">
			<div class="container">
				<p class="text-muted">Creado por Pablo Varela Gandía y Pablo Verdú Romero</p>
				<h6 class="text-muted">Aplicaciones Distribuidas en Internet - 2013 - Universidad de Alicante</h6>
			</div>
		</div>

		<div id="overLogin" class="overboxlogin">
			<div class="contentLightbox">
				<form class="form-horizontal">
	  				<fieldset>
	  					<legend>
	  						Login
	  					</legend>
	  					<div class="form-group" id="divLogin1">
		                    <label for="inputLogin" class="col-lg-3 control-label">Login</label>
		                    <div class="col-lg-5">
		                      <input type="text" class="form-control" id="inputLogin" placeholder="Login">
		                    </div>
		                </div>
		                <div class="form-group" id="divPassword1">
		                    <label for="inputPassword" class="col-lg-3 control-label">Password</label>
		                    <div class="col-lg-5">
		                      <input type="password" class="form-control" id="inputPassword" placeholder="Passwords">
		                    </div>
		                </div>
		                <div class="form-group"></div>
			            <div class="form-group">
			            	<div class="col-lg-9 col-lg-offset-3">
			            		<input type="button" class="btn btn-primary" value="Enviar" id="botonLogin"> 
			            	</div>
			            </div>
			            <div class="form-group"></div>
			            <div class="form-group"></div>
	  				</fieldset>
	  			</form>
				<a href="javascript:hideLoginLightbox();">Cerrar LightBox</a>
			</div>
			<div id="alertaLogin400" class="alertLogin">
				<div class="alert alert-dismissable alert-danger">
					<button id="closeAlertaLogin" type="button" class="close">×</button>
					<b>Error 400:</b> Hay campos obligatorios vacios.
				</div>
			</div>

			<div id="alertaLogin403" class="alertLogin">
				<div class="alert alert-dismissable alert-danger">
					<button id="closeAlerta403" type="button" class="close">×</button>
					<b>Error 403:</b> No existe un usuario registrado con esos datos.
				</div>
			</div>
		</div>
		<div id="fadeLogin" class="fadebox">&nbsp;</div>
		<div id="over" class="overboxregistro">
			<div class="contentLightbox">
				<form class="form-horizontal">
	  				<fieldset>
	  					<legend>
	  						Registrarse
	  					</legend>
	  					<div id="divNombre" class="form-group">
		                    <label for="inputNombre" class="col-lg-3 control-label">Nombre</label>
		                    <div class="col-lg-5">
		                      <input type="text" class="form-control" id="inputNombre" placeholder="Nombre">
		                    </div>
		                </div>
		                <div id="divApellidos" class="form-group">
		                    <label for="inputApellidos" class="col-lg-3 control-label">Apellidos</label>
		                    <div class="col-lg-5">
		                      <input type="text" class="form-control" id="inputApellidos" placeholder="Apellidos">
		                    </div>
		                </div>
		                <div id="divEmail" class="form-group">
		                    <label for="inputEmail" class="col-lg-3 control-label">Email</label>
		                    <div class="col-lg-5">
		                      <input type="text" class="form-control" id="inputEmail" placeholder="Email">
		                    </div>
		                </div>
		                <div id="divPassword2" class="form-group">
		                    <label for="inputPassword" class="col-lg-3 control-label">Password</label>
		                    <div class="col-lg-5">
		                      <input type="password" class="form-control"  id="inputPassword2" placeholder="Password">
		                    </div>
		                </div>
		                <div id="divRePassword2" class="form-group">
		                    <label for="inputRepeatPassword" class="col-lg-3 control-label">Repite Password</label>
		                    <div class="col-lg-5">
		                      <input type="password" class="form-control"  id="inputRepeatPassword" placeholder="Repite Password">
		                    </div>
		                </div>
			            <div class="form-group">
			            	<div class="col-lg-9 col-lg-offset-3">
			            		<input id="Enviar" type="button" value="Enviar" class="btn btn-primary">
			            	</div>
			            </div>
	  				</fieldset>
	  			</form>
				<a href="javascript:hideLightbox();">Cerrar LightBox</a>
			</div>
		</div>
	<div id="fade" class="fadebox">&nbsp;</div>

	<div id="alertLogin200" class="alertLogin">
		<div class="alert alert-dismissable alert-success">
			<button id="closeAlert200" type="button" class="close">×</button>
			Login realizado correctamente.
		</div>
	</div>

	<script type="text/javascript">

		//TODO: Mostrar nombre en la cabecera

		/*window.onload = function(){
			if(localStorage.login == undefined){
				document.getElementById('listaCabecera').innerHTML=
				'<li><a href="javascript:showLoginLightbox()">Login</a></li>
				<li><a href="javascript:showLightbox();">Registrarse</a></li>'
			} else {
				/*document.getElementById('listaCabecera').innerHTML=
				'<li>Bienvenido <a href="usuario?login='+localStorage.login+'">'+
				nombreUserReq(localStorage.login)+'</li>
				<li><a href="javascript:logout()">Logout</a></li>'

			}
		}

		var nombreUserReq = function(login) {
			req = new XMLHttpRequest();
			req.open('GET', 'api/usuarios/'+login, true)
			req.onreadystatechange = callbackNombreUserReq
			req.send(null)
		}

		var callbackNombreUserReq = function(){
			var nombre;
			if(req.readyState == 4){
				/*var usuario = JSON.parse(req.responseText)
				nombre = usuario.nombre + " " usuario.apellidos
			}

			return nombre
		}*/

	    function showLightbox() {
	        document.getElementById('over').style.display='block';
	        document.getElementById('fade').style.display='block';
	    }
	    function hideLightbox() {
	        document.getElementById('over').style.display='none';
	        document.getElementById('fade').style.display='none';
	    }
	    function showLoginLightbox() {
	    	//Visualiza lightbox.
	    	document.getElementById('overLogin').style.display='block';
	    	document.getElementById('fadeLogin').style.display='block';
	    	//Vacia campos anteriores y normaliza clases.
	    	document.getElementById('inputLogin').value = '';
	    	document.getElementById('inputPassword').value = '';
	    	document.getElementById('divLogin1').className = 'form-group';
	    	document.getElementById('divPassword1').className = 'form-group';
	    }
	    function hideLoginLightbox() {
	    	document.getElementById('overLogin').style.display='none';
	    	document.getElementById('fadeLogin').style.display='none';
	    }
	    /*
	    document.getElementById("Enviar").onclick = function() {
	    	if(document.getElementById("inputNombre").value == "") {
	    		document.getElementById("divNombre").className += " has-warning";
	    	}
	    	if(document.getElementById("inputApellidos").value == "") {
	    		document.getElementById("divApellidos").className += " has-warning";
	    	}
	    	if(document.getElementById("inputEmail").value == "") {
	    		document.getElementById("divEmail").className += " has-warning";
	    	}
	    	if(document.getElementById("inputPassword").value == "") {
	    		document.getElementById("divPassword").className += " has-warning";
	    	}
	    	if(document.getElementById("inputRepeatPassword").value == "") {
	    		document.getElementById("divRePassword").className += " has-warning";
	    	}
	    }*/

	    /*Mensajes de alerta para el login*/
	    var showAlert200 = function(){
	    	document.getElementById('alertLogin200').style.display='block'
	    	document.getElementById('closeAlert200').onclick = function () {
	    		document.getElementById('alertLogin200').style.display='none'
	    	}
	    }

	    var showAlert400 = function(){
	    	document.getElementById('alertaLogin400').style.display="block"
	    	document.getElementById('closeAlertaLogin').onclick = function () {
	    		document.getElementById('alertaLogin400').style.display='none'
	    	}
	    }

	    var showAlert403 = function(){
	    	document.getElementById('alertaLogin403').style.display="block"
	    	document.getElementById('closeAlerta403').onclick = function () {
	    		document.getElementById('alertaLogin403').style.display='none'
	    	}
	    }

	    /*Logica del login*/
	    var callbackLogin = function(){
	    	if (req.readyState == 4){
	    		switch(req.status){
	    			case 200:
	    				localStorage.login = document.getElementById('inputLogin').value;
	    				hideLoginLightbox();
	    				showAlert200();
	    				break;
	    			case 400:
	    				showAlert400();
	    				break;
	    			case 403:
	    				showAlert403();
	    				break;
	    		}
	    	}
	    }

	    document.getElementById("botonLogin").onclick=function(){
	    	req = new XMLHttpRequest();
	    	var id = document.getElementById('inputLogin').value;
	    	var pass = document.getElementById('inputPassword').value;
	    	req.open('POST', 'login', true);
	    	req.setRequestHeader('content-type', 'application/x-www-form-urlencoded')
	    	req.onreadystatechange = callbackLogin;
	    	req.send('login='+id+'&password='+pass);
	    }



	    /*Controles del lightbox login*/
	    document.getElementById("inputLogin").onblur = function () {
	    	if(document.getElementById("inputLogin").value == ""){
	    		document.getElementById("divLogin1").className += " has-warning"
	    	} else {
	    		document.getElementById("divLogin1").className = "form-group"
	    	}
	    }

	    document.getElementById("inputPassword").onblur = function () {
	    	if(document.getElementById("inputPassword").value == ""){
	    		document.getElementById("divPassword1").className += " has-warning"
	    	} else {
	    		document.getElementById("divPassword1").className = "form-group"
	    	}
	    }

	    document.getElementById("inputPassword").onfocus = function () {
	    	if(document.getElementById("inputLogin").value == "") {
	    		document.getElementById("divLogin1").className += " has-warning"
	    	} else {
	    		document.getElementById("divLogin1").className = "form-group"
	    	}
	    }

	    /*Controles del lightbox registro*/
	    document.getElementById("inputApellidos").onfocus = function() {
	    	if(document.getElementById("inputNombre").value == "") {
	    		document.getElementById("divNombre").className += " has-warning"
	    	}
	    	else {
	    		document.getElementById("divNombre").className = "form-group"
	    	}
	    }

	    document.getElementById("inputEmail").onfocus = function() {
	    	if(document.getElementById("inputApellidos").value == "") {
	    		document.getElementById("divApellidos").className += " has-warning"
	    	}
	    	else {
	    		document.getElementById("divApellidos").className = "form-group"
	    	}
	    }

	    document.getElementById("inputPassword2").onfocus = function() {
	    	if(document.getElementById("inputEmail").value == "") {
	    		document.getElementById("divEmail").className += " has-warning"
	    	}
	    	else {
	    		document.getElementById("divEmail").className = "form-group"
	    	}
	    }

	    document.getElementById("inputPassword2").onfocus = function() {
	    	if(document.getElementById("inputEmail").value == "") {
	    		document.getElementById("divEmail").className += " has-warning"
	    	}
	    	else {
	    		document.getElementById("divEmail").className = "form-group"
	    	}
	    }

	    document.getElementById("inputRepeatPassword").onfocus = function() {
	    	if(document.getElementById("inputPassword2").value == "") {
	    		document.getElementById("divPassword2").className += " has-warning"
	    	}
	    	else {
	    		document.getElementById("divPassword2").className = "form-group"
	    	}
	    }

    </script>


	</body>
</html>